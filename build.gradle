/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */
plugins {
    id 'org.springframework.boot' version '2.1.5.RELEASE'
    id 'java'
}

apply from:'config.gradle'

allprojects {
    apply plugin: 'eclipse'
    apply plugin: 'idea'

    group = 'org.springboot'
    version = '0.0.1-SNAPSHOT'

    // default build dir is build/ but idea compile dir is out/
    // dir out/ just have production/ and test/ dir
    buildDir = 'out/build'
}

def dubboProjects = [ project(':dubbo-server'), project(':dubbo-client')]

subprojects {
    apply plugin: 'java'
    apply plugin: 'io.spring.dependency-management'

    repositories {
        //jcenter()
        //mavenCentral()

        maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' }
        maven { url 'https://repository.apache.org/content/repositories/snapshots' }
        //maven { url 'https://repo.spring.io/release/' }
        //maven { url "https://repo.spring.io/libs-snapshot-local" }
        //maven { url "https://repo.spring.io/libs-milestone-local" }
        //maven { url "https://repo.spring.io/libs-release-local" }
    }

    sourceSets {
        main {
            java {
                srcDir 'source/java'
            }
            resources {
                srcDir 'config'
            }
        }

        test {
            java {
                srcDir 'source/test-java'
            }
            resources {
                srcDir 'source/test-resources'
            }
        }
    }

    dependencyManagement {
        imports {
            mavenBom 'io.spring.platform:platform-bom:Cairo-SR7'

            // https://github.com/apache/dubbo-spring-boot-project/tree/2.7.x
            //mavenBom 'org.apache.dubbo:dubbo-dependencies-bom:2.7.1'
            //mavenBom 'org.apache.dubbo:dubbo:2.7.1'
            //mavenBom "org.springframework.cloud:spring-cloud-dependencies:Finchley.SR3"
        }
    }

    dependencies {

        // 查看依赖 gradle :config-server:dependencies --configuration implementation --scan

        compileOnly libs['lombok']
        annotationProcessor libs['lombok']

        //this way equals dependencyManagement imports mavenBom
        // import a BOM  this way equals dependencyManagement imports mavenBom
        //implementation platform('org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE')
        // import a BOM. The versions used in this file will override any other version found in the graph
        //implementation enforcedPlatform('org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE')

        // https://github.com/apache/dubbo-spring-boot-project/tree/2.7.x
        implementation platform ("org.apache.dubbo:dubbo-dependencies-bom:$ver.dubbo")
        implementation platform ("org.apache.dubbo:dubbo:$ver.dubbo")

        testCompile 'org.springframework.boot:spring-boot-starter-test'
        //添加本地第三方依赖
        //compile fileTree(dir: 'third-libs', include: ['*.jar'])
        implementation 'org.springframework.boot:spring-boot-starter'
    }

    task listJars {
        //getProject().dependencies.each { File file -> println file.name };
       // configurations.compile.each { File file -> println file.name }
        println configurations.implementation
        //+ configurations.testCompile
        //jars.each { File file -> println file.name }

        //configurations.compile.each { File file -> println file.name }
        //configurations.testCompile.each { File file -> println file.name }
    }

    clean.doFirst {
        delete 'out'
    }
}

configure(dubboProjects) {
    dependencies {
        implementation (
                "org.apache.dubbo:dubbo-spring-boot-starter:$ver.dubbo",
                "org.apache.dubbo:dubbo",
                "org.apache.dubbo:dubbo-dependencies-zookeeper:$ver.dubbo"
        )
    }
}